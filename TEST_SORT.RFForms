<Record FileDesc="Test Sorting" FileVersion="5.0.8.0" Desc="Test Sorting" Group="ADM" LinkTo="No Links" LinkType="0" PromptList="ListBox1&vm;TextBox1" ImageList="0&vm;0" AuthTableList="0&vm;0">
<Schema>
<SchemaParam Linked="0" Attr="1" Name="ListBox1" />
<SchemaParam Linked="0" Attr="2" Name="TextBox1" />
</Schema>
<Displays>
<Display Name="(Default)" Type="1" Width="240" Height="320" Locale="1033" />
</Displays>
<Form Type="0" Attr="0" LinkMode="0">
<Controls>
<Control Type="3" FieldId="ListBox1" Attr="1" Sorted="0">
<Layouts>
<Layout PageNo="1" Visible="1" ZOrder="0" RowSelector="0" Scrollbars="0" ExtendCol="-1" GridLines="0" GridColor="1" AltColor="1" HeadBackColor1="1" HeadBackColor2="1" HeadBackFill="0" HeadForeColor="1" HeadPadding="-1" HeadVisible="0">
<Label Align="0" Anchor="3" AutoSize="1" BorderStyle="5" DropShadow="0" BackFill="0" Theme="0" FontSize="0" FontStyle="0" MultiLine="0" Left="10" Top="11" Width="65" Height="22" AnchorRight="925" AnchorBottom="967" BackColor1="1" BackColor2="1" ForeColor="1" Caption="ListBox" />
<Field Align="0" Anchor="3" AutoSize="0" BorderStyle="0" DropShadow="0" BackFill="0" Theme="0" FontSize="0" FontStyle="0" MultiLine="0" Left="10" Top="33" Width="939" Height="572" AnchorRight="51" AnchorBottom="395" BackColor1="1" BackColor2="1" ForeColor="1" DisplayOnly="1" />
<Columns>
<Column Caption="1" />
<Column Align="0" Width="-1" AutoSize="1" TrimSpaces="0" Decimals="0" BackFill="0" BackColor1="1" BackColor2="1" ForeColor="1" Style="0" DisplayOnly="0" Visible="1" ImageHeight="16" ImageWidth="16" PadBottom="2" PadLeft="2" PadRight="2" PadTop="2" FontStyle="0" FontSize="0" />
</Columns>
</Layout>
<Layout PageNo="1" Visible="1" ZOrder="0" RowSelector="1" Scrollbars="0" ExtendCol="-1" GridLines="0" GridColor="1" AltColor="1" HeadBackColor1="1" HeadBackColor2="1" HeadBackFill="0" HeadForeColor="1" HeadPadding="-1" HeadVisible="1">
<Label Align="0" Anchor="3" AutoSize="1" BorderStyle="5" DropShadow="0" BackFill="0" Theme="0" FontSize="0" FontStyle="0" MultiLine="0" Left="0" Top="44" Width="65" Height="22" AnchorRight="175" AnchorBottom="298" BackColor1="1" BackColor2="1" ForeColor="1" Caption="ListBox" />
<Field Align="0" Anchor="3" AutoSize="0" BorderStyle="0" DropShadow="0" BackFill="0" Theme="0" FontSize="0" FontStyle="0" MultiLine="0" Left="0" Top="66" Width="239" Height="220" AnchorRight="232" AnchorBottom="34" BackColor1="1" BackColor2="1" ForeColor="1" DisplayOnly="0" />
<Columns>
<Column Caption="1" />
<Column Align="0" Width="-1" AutoSize="1" TrimSpaces="0" Decimals="0" BackFill="0" BackColor1="1" BackColor2="1" ForeColor="1" Style="0" DisplayOnly="0" Visible="1" ImageHeight="16" ImageWidth="16" PadBottom="2" PadLeft="2" PadRight="2" PadTop="2" FontStyle="0" FontSize="0" />
</Columns>
</Layout>
</Layouts>
</Control>
<Control Type="1" FieldId="TextBox1" Attr="2" KeyField="0" MaskInput="0" Required="0" SipMode="0">
<Layouts>
<Layout PageNo="1" Visible="1" ZOrder="0">
<Label Align="0" Anchor="3" AutoSize="1" BorderStyle="5" DropShadow="0" BackFill="0" Theme="0" FontSize="0" FontStyle="0" MultiLine="0" Left="10" Top="605" Width="65" Height="22" AnchorRight="925" AnchorBottom="978" BackColor1="1" BackColor2="1" ForeColor="1" Caption="TextBox" />
<Field Align="0" Anchor="3" AutoSize="0" BorderStyle="0" DropShadow="0" BackFill="0" Theme="0" FontSize="0" FontStyle="0" MultiLine="0" Left="83" Top="605" Width="80" Height="22" AnchorRight="909" AnchorBottom="373" BackColor1="1" BackColor2="1" ForeColor="1" DisplayOnly="0" />
</Layout>
<Layout PageNo="1" Visible="1" ZOrder="0">
<Label Align="0" Anchor="3" AutoSize="1" BorderStyle="5" DropShadow="0" BackFill="0" Theme="0" FontSize="0" FontStyle="0" MultiLine="0" Left="0" Top="286" Width="65" Height="22" AnchorRight="935" AnchorBottom="978" BackColor1="1" BackColor2="1" ForeColor="1" Caption="TextBox" />
<Field Align="0" Anchor="3" AutoSize="0" BorderStyle="0" DropShadow="0" BackFill="0" Theme="0" FontSize="0" FontStyle="0" MultiLine="0" Left="73" Top="286" Width="80" Height="22" AnchorRight="919" AnchorBottom="692" BackColor1="1" BackColor2="1" ForeColor="1" DisplayOnly="0" />
</Layout>
</Layouts>
</Control>
</Controls>
<Layouts>
<Layout PageNo="1" Visible="1" ZOrder="0" ImageAlign="0" FormWidth="1000" FormHeight="1000" Scrollbars="0">
<Label Align="1" Anchor="3" AutoSize="2" BorderStyle="0" DropShadow="0" BackFill="0" Theme="0" FontSize="0" FontStyle="0" MultiLine="0" Left="0" Top="0" Width="1000" Height="22" AnchorRight="0" AnchorBottom="298" BackColor1="1" BackColor2="1" ForeColor="1" />
<Field Align="0" Anchor="3" AutoSize="0" BorderStyle="3" DropShadow="0" BackFill="0" Theme="0" FontSize="0" FontStyle="0" MultiLine="0" Left="0" Top="0" Width="1000" Height="1000" AnchorRight="-122" AnchorBottom="298" BackColor1="1" BackColor2="1" ForeColor="1" DisplayOnly="0" />
</Layout>
<Layout PageNo="1" Visible="1" ZOrder="0" ImageAlign="0" FormWidth="240" FormHeight="320" Scrollbars="0">
<Label Align="1" Anchor="3" AutoSize="2" BorderStyle="0" DropShadow="0" BackFill="0" Theme="0" FontSize="0" FontStyle="0" MultiLine="0" Left="0" Top="0" Width="240" Height="22" AnchorRight="0" AnchorBottom="298" BackColor1="1" BackColor2="1" ForeColor="1" />
<Field Align="0" Anchor="3" AutoSize="0" BorderStyle="3" DropShadow="0" BackFill="0" Theme="0" FontSize="0" FontStyle="0" MultiLine="0" Left="0" Top="0" Width="240" Height="320" AnchorRight="-16" AnchorBottom="298" BackColor1="1" BackColor2="1" ForeColor="1" DisplayOnly="0" />
</Layout>
</Layouts>
</Form>
</Record>
<Code>
Option Explicit
Option Explicit

Private msValCache As String

Public Sub BuildListBox
  On Error Resume Next
  '
  Dim sDsp    As String
  Dim iCnt    As Integer
  Dim vArray  As Variant
  Dim sKey As String
  Dim nCount As Integer

  ListBox1.List.Clear

  nCount = DCount(msValCache, Chr(1))
  'If nCount > 20 Then nCount = 20

  For iCnt = 1 To 6
    vArray = Split(Ext(msValCache,1, iCnt),";")
    If iCnt = 1 Then
      ListBox1.Caption = "Scanned Items for Company: " & CStr(vArray(0)) & " , Plant: " & vArray(1) & " count: " & DCount(msValCache, Chr(2))
    End If

    sDsp =        FixRight(vArray(02),8," ")                      & "|"
    sDsp = sDsp & FixLeft(vArray(03),2," ")                       & "|"
    sDsp = sDsp & FixRight(Format(vArray(04), "##0.000"),7," ")   & "|"
    sDsp = sDsp & FixLeft(Ext(msValCache,02,  iCnt),giLenItem," ") & "|"
    sDsp = sDsp & FixRight(Ext(msValCache,03, iCnt),10," ")       & "|"
    sDsp = sDsp & FixLeft(Ext(msValCache,04,  iCnt),giLenLOCN," ") & "|"
    sDsp = sDsp & FixRight(Ext(msValCache,05, iCnt),10," ")       & "|"
    sDsp = sDsp & FixLeft(Ext(msValCache,06,  iCnt),03," ")       & "|"
    sDsp = sDsp & FixLeft(Ext(msValCache,07,  iCnt),giLenLOTN," ") & "|"
    sDsp = sDsp & FixLeft(Ext(msValCache,08,  iCnt),01," ")       & "|"
    sDsp = sDsp & FixRight(Ext(msValCache,09, iCnt),10," ")       & "|"
    sDsp = sDsp & FixRight(Ext(msValCache,10, iCnt),10," ")       & "|"
    sDsp = sDsp & FixRight(Ext(msValCache,11, iCnt),10," ")       & "|"
    sDsp = sDsp & FixLeft(Ext(msValCache,12,  iCnt),01," ")       & "|"
    sDsp = sDsp & FixRight(Ext(msValCache,13, iCnt),07," ")       & "|"
    sDsp = sDsp & FixRight(Ext(msValCache,14, iCnt),08," ")       & "|"
    sDsp = sDsp & FixRight(Ext(msValCache,15, iCnt),08," ")       & "|"

    sKey = sDsp
    sDsp = Replace(sDsp, "|", " ")


'    ListBox1.List.AddItem("", _
'      FixRight(vArray(02),8," "), _
'      FixLeft(vArray(03),2," "), _
'      FixRight(Format(vArray(04), "##0.000"),7," "), _
'      FixLeft(Ext(msValCache,02,  iCnt),giLenItem," "), _
'      FixRight(Ext(msValCache,03, iCnt),10," "), _
'      FixLeft(Ext(msValCache,04,  iCnt),giLenLOCN," "), _
'      FixRight(Ext(msValCache,05, iCnt),10," "), _
'      FixLeft(Ext(msValCache,06,  iCnt),03," "), _
'      FixLeft(Ext(msValCache,07,  iCnt),giLenLOTN," "), _
'      FixLeft(Ext(msValCache,08,  iCnt),01," "), _
'      FixRight(Ext(msValCache,09, iCnt),10," "), _
'      FixRight(Ext(msValCache,10, iCnt),10," "), _
'      FixRight(Ext(msValCache,11, iCnt),10," "), _
'      FixLeft(Ext(msValCache,12,  iCnt),01," "), _
'      FixRight(Ext(msValCache,13, iCnt),07," "), _
'      FixRight(Ext(msValCache,14, iCnt),08," "), _
'      FixRight(Ext(msValCache,15, iCnt),08," ") _
'    )

    Log("TEST_SORT", "BuildListBox", "sDsp " & iCnt & ": " & sDsp)
    ListBox1.List.AddItem sKey, sDsp
  Next iCnt
    '
  ' sort listbox to make sure all SO lines are in sequence
  ListBox1.List.Sorted = True

End Sub

Private Sub Form_Load()
  On Error Resume Next

  'msValCache = "00002;          50;33689;ST;  1.000;108516.108558;DOCK      ;#00002;          50;33689;ST;  1.000;108630.108680;DOCK      ;#00002;          50;33689;ST;  1.000;107591.107679;DOCK      ;#00002;          50;33689;ST;  3.000;107385.107465;DOCK      ;#00002;          50;33689;ST;  3.000;105421.105572;DOCK      ;&ASLQT     #ASLQT     #ASLQT     #MCFQT     #MCFQT     &    116839#    116839#    116839#      6610#      6610&DOCK      #DOCK      #DOCK      #DOCK      #DOCK      &        12#        12#        48#        12#        60&EA #EA #EA #EA #EA &108516.108558#108630.108680#107591.107679#107385.107465#105421.105572&S#S#S#S#S&         0#         0#         0#         0#         0&         0#         0#         0#         0#         0&        72#        72#        72#        72#        72&S#S#S#S#S&      1#      1#      1#      3#      3&      34#      34#      34#      34#      34&       0#       0#       0#       0#       0"
  'msValCache = "00002;          50;33691;ST;3;108807.108819; ;#00002;          50;33691;ST;2;105874.105960; ;#00002;          50;33691;ST;1;107299.107377; ;#00002;          50;33691;ST;1;107904.107959; ;#00002;          50;33691;ST;3;108487.108514; ;#00002;          50;33691;ST;2;108543.108615; ;&DEOQT#PCKQT#OEFQT#OEFQT#DEOQT#PCKQT&9490#119728#15930#15930#9490#119728& # # # # # &12#12#120#24#60#60&EA#EA#EA#EA#EA#EA&108807.108819#105874.105960#107299.107377#107904.107959#108487.108514#108543.108615&S#S#S#S#S#S&0#0#0#0#0#0&0#0#0#0#0#0&72#72#144#144#72#72&S #S #S #S #S #S &3#2#1#1#3#2&34#34#34#34#34#34&0#0#0#0#0#0"
  msValCache = "00002;          50;33691;ST;  2.000;108543.108615;          ;#00002;          50;33691;ST;  3.000;108487.108514;          ;#00002;          50;33691;ST;  1.000;107904.107959;          ;#00002;          50;33691;ST;  1.000;107299.107377;          ;#00002;          50;33691;ST;  2.000;105874.105960;          ;#00002;          50;33691;ST;  3.000;108807.108819;          ;&PCKQT     #DEOQT     #OEFQT     #OEFQT     #PCKQT     #DEOQT     &    119728#      9490#     15930#     15930#    119728#      9490&          #          #          #          #          #          &        60#        60#        24#       120#        12#        12&EA #EA #EA #EA #EA #EA &108543.108615#108487.108514#107904.107959#107299.107377#105874.105960#108807.108819&S#S#S#S#S#S&         0#         0#         0#         0#         0#         0&         0#         0#         0#         0#         0#         0&        72#        72#       144#       144#        72#        72&S#S#S#S#S#S&      2#      3#      1#      1#      2#      3&      34#      34#      34#      34#      34#      34&       0#       0#       0#       0#       0#       0"

  msValCache = Replace(msValCache, "&", Chr(1))
  msValCache = Replace(msValCache, "#", Chr(2))
  msValCache = Replace(msValCache, "@", Chr(3))

  BuildListBox
End Sub

Public Sub Form_OnUpdate(ByRef Cancel As Boolean)
  On Error Resume Next

  Dim iCnt As Integer
  Dim vArray As Variant
  Dim nQty As Currency
  Dim sValCache As String
  Dim sKey As String
  Dim iFnd As Integer

  For iCnt = 1 To 6
    ListBox1.List.Index = iCnt
    vArray = Split(ListBox1.Text,"|")
    
    '                  Company                    Plant                Order Number            Doctype            Line Number        Lot Number         Location
    sKey = App.GetValue("tmCO") & ";" & App.GetValue("tmMCU") & ";" & Trim(vArray(0)) & ";" & Trim(vArray(1)) & ";" &  vArray(2) & ";" &  vArray(8) & ";" &  vArray(5) & ";"
    iFnd = Locate(sKey, sValCache,1)

    If (iFnd <> 0) Then     'add qty RBR 03/07/2007
      nQty  = Val(Ext(msValCache, 06, iFnd))
      nQty = nQty + vArray(06)
      sValCache = Rep(msValCache, 06, iFnd, nQty)
    Else
      sValCache = Rep(sValCache, 01, -1, sKey)                    'unique key
      sValCache = Rep(sValCache, 02, -1, vArray(03))    'long Item Number
      sValCache = Rep(sValCache, 03, -1, vArray(04))    'short Item Number
      sValCache = Rep(sValCache, 04, -1, vArray(05))    'Location
      sValCache = Rep(sValCache, 05, -1, vArray(06))    'Picked Qty.
      sValCache = Rep(sValCache, 06, -1, vArray(07))    'Transaction UOM
      sValCache = Rep(sValCache, 07, -1, vArray(08))    'Lot - / Serial number
      sValCache = Rep(sValCache, 08, -1, vArray(09))    'Commitment Flag S/H
      sValCache = Rep(sValCache, 09, -1, vArray(10))    'Backorder Qty.
      sValCache = Rep(sValCache, 10, -1, vArray(11))    'Canceled Qty
      sValCache = Rep(sValCache, 11, -1, vArray(12))    'Line Qty.
      sValCache = Rep(sValCache, 12, -1, vArray(13))    'Line Type
      sValCache = Rep(sValCache, 13, -1, vArray(14))    'Line Number
      sValCache = Rep(sValCache, 14, -1, vArray(15))    'Ship To
      sValCache = Rep(sValCache, 15, -1, vArray(16))    'Carrier
    End If
    Stop
    Debug.Print(sValCache)
  Next iCnt

  Cancel = True

End Sub

</Code>
